{% extends "base.html" %}

{% block title %}Professional Resume Access - {{ config.TITLE }}{% endblock %}

{% block content %}
<div class="container-fluid bg-gradient-primary py-5">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-lg-8 col-xl-6">
                <div class="card shadow-lg border-0">
                    <div class="card-header bg-primary text-white text-center py-4">
                        <h2 class="mb-0">
                            <i class="fas fa-shield-check me-3"></i>
                            Professional Resume Access
                        </h2>
                        <p class="mb-0 mt-2 opacity-75">Enterprise-Grade Security Verification</p>
                    </div>
                    
                    <div class="card-body p-5">
                        <!-- Flash Messages -->
                        {% with messages = get_flashed_messages(with_categories=true) %}
                            {% if messages %}
                                {% for category, message in messages %}
                                    <div class="alert alert-{{ 'danger' if category == 'error' else 'success' if category == 'success' else 'info' }} alert-dismissible fade show" role="alert">
                                        <i class="fas fa-{{ 'exclamation-triangle' if category == 'error' else 'check-circle' if category == 'success' else 'info-circle' }} me-2"></i>
                                        {{ message }}
                                        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                                    </div>
                                {% endfor %}
                            {% endif %}
                        {% endwith %}

                        <div class="text-center mb-4">
                            <h4 class="text-primary mb-3">
                                <i class="fas fa-user-tie me-2"></i>
                                Professional Verification Required
                            </h4>
                            <p class="text-muted">
                                This resume contains sensitive professional information. Please complete the verification process to ensure secure access.
                            </p>
                        </div>

                        <form method="POST" action="{{ url_for('main.professional_verify_access') }}" id="professionalAccessForm">
                            
                            <!-- Professional Information Section -->
                            <div class="row mb-4">
                                <div class="col-12">
                                    <div class="card bg-light border-0">
                                        <div class="card-body">
                                            <h6 class="text-primary mb-3">
                                                <i class="fas fa-briefcase me-2"></i>
                                                Professional Context
                                            </h6>
                                            
                                            <div class="row">
                                                <div class="col-md-6 mb-3">
                                                    <label for="professionalEmail" class="form-label">
                                                        <i class="fas fa-envelope me-1"></i>
                                                        Professional Email *
                                                    </label>
                                                    <input type="email" class="form-control" id="professionalEmail" name="professional_email" required>
                                                    <small class="text-muted">Corporate emails receive priority access</small>
                                                </div>
                                                
                                                <div class="col-md-6 mb-3">
                                                    <label for="company" class="form-label">
                                                        <i class="fas fa-building me-1"></i>
                                                        Company/Organization
                                                    </label>
                                                    <input type="text" class="form-control" id="company" name="company" placeholder="e.g., Google, Microsoft, Acme Corp">
                                                </div>
                                            </div>
                                            
                                            <div class="row">
                                                <div class="col-md-6 mb-3">
                                                    <label for="role" class="form-label">
                                                        <i class="fas fa-user-tag me-1"></i>
                                                        Your Role
                                                    </label>
                                                    <select class="form-select" id="role" name="role">
                                                        <option value="">Select your role</option>
                                                        <option value="recruiter">Recruiter/HR</option>
                                                        <option value="hiring_manager">Hiring Manager</option>
                                                        <option value="tech_lead">Technical Lead</option>
                                                        <option value="cto_vp">CTO/VP Engineering</option>
                                                        <option value="consultant">Consultant</option>
                                                        <option value="peer">Industry Peer</option>
                                                        <option value="other">Other</option>
                                                    </select>
                                                </div>
                                                
                                                <div class="col-md-6 mb-3">
                                                    <label for="purpose" class="form-label">
                                                        <i class="fas fa-target me-1"></i>
                                                        Access Purpose
                                                    </label>
                                                    <select class="form-select" id="purpose" name="purpose" required>
                                                        <option value="">Select purpose</option>
                                                        <option value="job_opportunity">Job Opportunity</option>
                                                        <option value="consulting_project">Consulting Project</option>
                                                        <option value="partnership">Partnership Discussion</option>
                                                        <option value="networking">Professional Networking</option>
                                                        <option value="reference_check">Reference/Background Check</option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Security Features Display -->
                            <div class="row mb-4">
                                <div class="col-12">
                                    <div class="card border-success">
                                        <div class="card-body text-center py-3">
                                            <h6 class="text-success mb-3">
                                                <i class="fas fa-shield-alt me-2"></i>
                                                Security Features Active
                                            </h6>
                                            <div class="row">
                                                <div class="col-md-3 mb-2">
                                                    <small class="text-success">
                                                        <i class="fas fa-check-circle me-1"></i>
                                                        Professional Verification
                                                    </small>
                                                </div>
                                                <div class="col-md-3 mb-2">
                                                    <small class="text-success">
                                                        <i class="fas fa-clock me-1"></i>
                                                        Rate Limited Access
                                                    </small>
                                                </div>
                                                <div class="col-md-3 mb-2">
                                                    <small class="text-success">
                                                        <i class="fas fa-key me-1"></i>
                                                        Secure Token System
                                                    </small>
                                                </div>
                                                <div class="col-md-3 mb-2">
                                                    <small class="text-success">
                                                        <i class="fas fa-user-shield me-1"></i>
                                                        Context Analysis
                                                    </small>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Professional Challenge Section -->
                            <div class="row mb-4" id="professionalChallenge" style="display: none;">
                                <div class="col-12">
                                    <div class="card border-warning">
                                        <div class="card-body">
                                            <h6 class="text-warning mb-3">
                                                <i class="fas fa-brain me-2"></i>
                                                Professional Knowledge Verification
                                            </h6>
                                            <div id="challengeContent">
                                                <!-- Dynamic challenge content will be loaded here -->
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- reCAPTCHA Section -->
                            {% if recaptcha_site_key %}
                            <div class="row mb-4">
                                <div class="col-12">
                                    <div class="card border-primary">
                                        <div class="card-body text-center py-4">
                                            <h6 class="text-primary mb-3">
                                                <i class="fas fa-robot me-2"></i>
                                                Bot Protection Verification
                                            </h6>
                                            <p class="text-muted mb-3">
                                                Please complete the security challenge below to verify you're human.
                                            </p>
                                            <div class="d-flex justify-content-center">
                                                <div class="g-recaptcha" 
                                                     data-sitekey="{{ recaptcha_site_key }}"
                                                     data-theme="light"
                                                     data-size="normal">
                                                </div>
                                            </div>
                                            <div class="mt-3">
                                                <small class="text-success">
                                                    <i class="fas fa-check-circle me-1"></i>
                                                    <strong>Security:</strong> reCAPTCHA v2 + Professional Verification
                                                </small>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            {% else %}
                            <div class="alert alert-info text-center" role="alert">
                                <i class="fas fa-info-circle me-2"></i>
                                <strong>Development Mode:</strong> Professional verification active, reCAPTCHA configuration pending.
                            </div>
                            {% endif %}

                            <!-- Submit Button -->
                            <div class="row">
                                <div class="col-12">
                                    <button type="submit" class="btn btn-primary btn-lg w-100" id="verifyBtn">
                                        <i class="fas fa-shield-check me-2"></i>
                                        Verify Professional Access & Download Resume
                                    </button>
                                </div>
                            </div>
                        </form>

                        <!-- Privacy Notice -->
                        <div class="text-center mt-4">
                            <small class="text-muted">
                                <i class="fas fa-lock me-1"></i>
                                Your professional information is used solely for access verification and is not stored or shared.
                                <br>
                                <i class="fas fa-shield-alt me-1"></i>
                                This system complies with security standards and privacy regulations.
                            </small>
                        </div>
                    </div>
                    
                    <div class="card-footer text-center py-3 bg-light">
                        <div class="row">
                            <div class="col-md-6 mb-2">
                                <a href="{{ url_for('main.index') }}" class="btn btn-outline-secondary">
                                    <i class="fas fa-arrow-left me-2"></i>
                                    Back to Portfolio
                                </a>
                            </div>
                            <div class="col-md-6 mb-2">
                                <small class="text-muted">
                                    <i class="fas fa-info-circle me-1"></i>
                                    Need help? Contact via the main portfolio
                                </small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- reCAPTCHA Script -->
{% if recaptcha_site_key %}
<script src="https://www.google.com/recaptcha/api.js" async defer></script>
{% endif %}

<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('professionalAccessForm');
    const verifyBtn = document.getElementById('verifyBtn');
    const emailInput = document.getElementById('professionalEmail');
    const roleSelect = document.getElementById('role');
    const challengeDiv = document.getElementById('professionalChallenge');
    
    // Email domain analysis
    emailInput.addEventListener('blur', function() {
        const email = this.value.toLowerCase();
        const domain = email.split('@')[1];
        
        if (domain) {
            analyzeEmailDomain(domain);
        }
    });
    
    function analyzeEmailDomain(domain) {
        const corporateDomains = [
            'google.com', 'microsoft.com', 'apple.com', 'amazon.com', 'meta.com',
            'netflix.com', 'uber.com', 'airbnb.com', 'spotify.com', 'zoom.us',
            'mckinsey.com', 'bcg.com', 'bain.com', 'deloitte.com', 'pwc.com',
            'ey.com', 'kpmg.com', 'accenture.com', 'ibm.com', 'oracle.com'
        ];
        
        const emailFeedback = document.createElement('div');
        emailFeedback.className = 'mt-2';
        
        // Remove existing feedback
        const existingFeedback = emailInput.parentNode.querySelector('.email-feedback');
        if (existingFeedback) {
            existingFeedback.remove();
        }
        
        if (corporateDomains.includes(domain)) {
            emailFeedback.innerHTML = '<small class="text-success email-feedback"><i class="fas fa-check-circle me-1"></i>Corporate email detected - Priority access granted</small>';
            // Skip professional challenge for corporate emails
            challengeDiv.style.display = 'none';
        } else if (domain.includes('corp') || domain.includes('company') || domain.includes('inc')) {
            emailFeedback.innerHTML = '<small class="text-info email-feedback"><i class="fas fa-building me-1"></i>Business email detected - Standard verification</small>';
        } else if (['gmail.com', 'yahoo.com', 'hotmail.com', 'outlook.com'].includes(domain)) {
            emailFeedback.innerHTML = '<small class="text-warning email-feedback"><i class="fas fa-user me-1"></i>Personal email - Enhanced verification required</small>';
            // Show professional challenge for personal emails
            showProfessionalChallenge();
        }
        
        emailInput.parentNode.appendChild(emailFeedback);
    }
    
    function showProfessionalChallenge() {
        const challenges = [
            {
                question: "What does 'CI/CD' stand for in software development?",
                options: ["Continuous Integration/Continuous Deployment", "Code Integration/Code Deployment", "Central Integration/Central Deployment"],
                correct: 0
            },
            {
                question: "In project management, what does 'MVP' typically mean?",
                options: ["Most Valuable Player", "Minimum Viable Product", "Maximum Value Proposition"],
                correct: 1
            }
        ];
        
        const challenge = challenges[Math.floor(Math.random() * challenges.length)];
        const challengeContent = document.getElementById('challengeContent');
        
        challengeContent.innerHTML = `
            <p class="mb-3"><strong>${challenge.question}</strong></p>
            <div class="challenge-options">
                ${challenge.options.map((option, index) => `
                    <div class="form-check mb-2">
                        <input class="form-check-input" type="radio" name="challenge_answer" id="option${index}" value="${index}" required>
                        <label class="form-check-label" for="option${index}">
                            ${option}
                        </label>
                    </div>
                `).join('')}
            </div>
            <input type="hidden" name="challenge_correct" value="${challenge.correct}">
        `;
        
        challengeDiv.style.display = 'block';
    }
    
    // Form submission
    form.addEventListener('submit', function(e) {
        // Show loading state
        verifyBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Verifying Professional Access...';
        verifyBtn.disabled = true;
        
        // Add professional context data
        const formData = new FormData(form);
        formData.append('user_agent', navigator.userAgent);
        formData.append('referrer', document.referrer);
        formData.append('timestamp', Date.now());
    });
});
</script>

<style>
.bg-gradient-primary {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
}

.card {
    border-radius: 15px;
    overflow: hidden;
}

.card-header {
    border-radius: 15px 15px 0 0 !important;
}

.form-control, .form-select {
    border-radius: 8px;
    border: 2px solid #e9ecef;
    transition: all 0.3s ease;
}

.form-control:focus, .form-select:focus {
    border-color: #667eea;
    box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
}

.btn-primary {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border: none;
    border-radius: 8px;
    padding: 12px 24px;
    font-weight: 600;
    transition: all 0.3s ease;
}

.btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
}

.challenge-options {
    background: #f8f9fa;
    padding: 15px;
    border-radius: 8px;
    border-left: 4px solid #ffc107;
}

.email-feedback {
    animation: fadeIn 0.3s ease-in;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(-10px); }
    to { opacity: 1; transform: translateY(0); }
}
</style>
{% endblock %}
